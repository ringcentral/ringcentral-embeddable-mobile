{"version":3,"sources":["webpack://ringcentral-embeddable-mobile/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://ringcentral-embeddable-mobile/webpack/bootstrap","webpack://ringcentral-embeddable-mobile/webpack/runtime/compat get default export","webpack://ringcentral-embeddable-mobile/webpack/runtime/define property getters","webpack://ringcentral-embeddable-mobile/webpack/runtime/hasOwnProperty shorthand","webpack://ringcentral-embeddable-mobile/external \"React\"","webpack://ringcentral-embeddable-mobile/external \"ReactDOM\"","webpack://ringcentral-embeddable-mobile/./src/client/app/event-handler.js","webpack://ringcentral-embeddable-mobile/./src/client/app/common.js","webpack://ringcentral-embeddable-mobile/./src/client/components/index/index.jsx","webpack://ringcentral-embeddable-mobile/./src/client/app.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","module","exports","postMessage","data","window","getCode","c","localStorage","getItem","setItem","login","msg","type","callbackUri","rc","getUrl","authUrlDefaultRc","replace","defaultState","view","onEvent","e","console","debug","log","oAuthUri","location","href","setTimeout","handleEvent","JSON","parse","stringify","addEventListener","wait","ms","Promise","resolve","waitUntilLoad","inited","cordova","plugins","iosrtc","loadScript","url","id","dom","document","getElementById","script","createElement","src","async","body","appendChild","App","Component","loggedIn","fetchingUser","loginning","isIOS","contentWindow","permissions","list","CAPTURE_AUDIO_OUTPUT","RECORD_AUDIO","checkPermission","status","hasPermission","requestPermissions","open","InAppBrowser","componentDidMount","initEvent","requirePermissions","render","server","appConfigQuery","renderReactDom","ReactDOM"],"mappings":"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","file":"js/app.bundle.js","sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","const __WEBPACK_NAMESPACE_OBJECT__ = React;","const __WEBPACK_NAMESPACE_OBJECT__ = ReactDOM;","/**\n * handle events\n */\n\nfunction postMessage (data) {\n  window.postMessage(data, '*')\n}\n\nexport function getCode () {\n  const key = 'rc-authcode'\n  const c = window.localStorage.getItem(key)\n  if (c) {\n    window.localStorage.setItem(key, '')\n    return c\n  } else {\n    return ''\n  }\n}\n\nexport function login (msg = postMessage) {\n  const c = getCode()\n  if (c) {\n    msg({\n      type: 'rc-adapter-authorization-code',\n      callbackUri: `${window.rc.callbackUri}?code=${c}`\n    })\n  }\n}\n\nexport function getUrl () {\n  return window.rc.authUrlDefaultRc.replace(\n    window.rc.defaultState,\n    window.rc.view\n  )\n}\n\nfunction onEvent (e) {\n  const { data } = e\n  console.debug('got data from ev', data)\n  if (data) {\n    switch (data.type) {\n      case 'rc-login-popup-notify':\n        // get login oAuthUri from widget\n        console.log('rc-login-popup-notify:', data.oAuthUri)\n        window.location.href = getUrl()\n        //  window.open(data.oAuthUri); // open oauth uri to login\n        break\n      case 'rc-adapter-pushAdapterState':\n        setTimeout(login, 100)\n        break\n      default:\n        break\n    }\n  }\n}\n\nexport function handleEvent () {\n  window.rc = JSON.parse(\n    window.localStorage.getItem('rc-data-ref', JSON.stringify(window.rc))\n  )\n  // window.top = window\n  // window.parent = window\n  window.addEventListener('message', onEvent)\n}\n","\nexport function wait (ms) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms)\n  })\n}\n\nexport async function waitUntilLoad () {\n  let inited = false\n  while (!inited) {\n    if (window.cordova && window.cordova.plugins && window.cordova.plugins.iosrtc) {\n      inited = true\n    } else {\n      console.log('wait')\n      await wait(50)\n    }\n  }\n  return true\n}\n\nexport function loadScript (url, id) {\n  const dom = document.getElementById(id)\n  if (dom) {\n    return\n  }\n  const script = document.createElement('script')\n  script.type = 'text/javascript'\n  script.src = 'app.js'\n  script.id = id\n  script.async = false\n  document.body.appendChild(script)\n}\n","import { Component } from 'react'\nimport {\n  getUrl,\n  login\n} from '../../app/event-handler'\nimport { wait } from '../../app/common'\n\nexport default class App extends Component {\n  state = {\n    loggedIn: false,\n    fetchingUser: false,\n    loginning: false\n  }\n\n  isIOS = window.rc.isIOS\n\n  componentDidMount () {\n    console.log('isios', this.isIOS)\n    this.initEvent()\n    if (!this.isIOS) {\n      this.requirePermissions()\n    }\n  }\n\n  postMessage = (data) => {\n    document.getElementById('rc-widget-adapter-frame').contentWindow.postMessage(data, '*')\n  }\n\n  waitUntilLoad = async () => {\n    let inited = false\n    while (!inited) {\n      if (window.cordova && window.cordova.plugins && window.cordova.plugins.permissions) {\n        inited = true\n      } else {\n        await wait(50)\n      }\n    }\n    return true\n  }\n\n  requirePermissions = async () => {\n    await this.waitUntilLoad()\n    try {\n      const { permissions } = cordova.plugins\n      const list = [\n        permissions.CAPTURE_AUDIO_OUTPUT,\n        permissions.RECORD_AUDIO\n      ]\n      permissions.checkPermission(list, (status) => {\n        console.log('permission list', status)\n        if (!status.hasPermission) {\n          permissions.requestPermissions(\n            list,\n            (status) => {\n              if (!status.hasPermission) {\n                console.log('set permission failed')\n              }\n            },\n            console.log\n          )\n        }\n      }, null)\n    } catch (e) {\n      console.log(e)\n    }\n  }\n\n  initEvent = () => {\n    if (typeof cordova !== 'undefined') {\n      window.open = cordova.InAppBrowser.open\n    }\n    window.addEventListener('message', this.onEvent)\n  }\n\n  login = () => {\n    setTimeout(() => {\n      login(this.postMessage)\n    }, 100)\n  }\n\n  onEvent = e => {\n    const { data } = e\n    console.debug('got data from ev', data)\n    if (data) {\n      switch (data.type) {\n        case 'rc-login-popup-notify':\n          // get login oAuthUri from widget\n          console.log('rc-login-popup-notify:', data.oAuthUri)\n          window.location.href = getUrl()\n          //  window.open(data.oAuthUri); // open oauth uri to login\n          break\n        case 'rc-adapter-pushAdapterState':\n          this.login()\n          break\n        default:\n          break\n      }\n    }\n  }\n\n  render () {\n    const url = this.isIOS\n      ? window.rc.server + '/embeddable/app.html' + window.rc.appConfigQuery\n      : 'https://ringcentral.github.io/ringcentral-embeddable/app.html' + window.rc.appConfigQuery\n    return (\n      <div id='app'>\n        <iframe\n          id='rc-widget-adapter-frame'\n          src={url}\n          sandbox='allow-same-origin allow-scripts allow-forms allow-popups'\n          allow='microphone'\n        />\n      </div>\n    )\n  }\n}\n","/**\n * entry file for install page\n */\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './components/index/index.jsx'\nimport './css/index.styl'\n\nconst renderReactDom = () => {\n  ReactDOM.render(<App />, document.getElementById('container'))\n}\n\nif (window.cordova) {\n  document.addEventListener('deviceready', () => {\n    renderReactDom()\n  }, false)\n} else {\n  renderReactDom()\n}\n"],"sourceRoot":""}